<?xml version="1.0" encoding="UTF-8" ?>
<f:view xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
        xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <h:head />

    <h:body>
        <c:set var="invoice" value="#{createInvoiceAddGrantBackingBean.invoice}" scope="request" />
        <c:set var="grant" value="#{createInvoiceAddGrantBackingBean.grant}" scope="request" />
        <c:set var="flow" value="#{createInvoiceAddGrantBackingBean.flow}" scope="request" />
        <c:set var="otherVO" value="#{createInvoiceAddGrantBackingBean.grantTypeOtherVO}" scope="request" />

        <ui:fragment rendered="#{invoice.calculateDifferenceExcludingVatAsKrona().unscaledValue() eq 0}">
            <div class="alert alert-info">
                Samtliga bidrag på fakturan verkar vara registrerade.
            </div>
            <div class="button-row">
                <h:link styleClass="link-btn primary" value="Gå till översikt" outcome="view_invoice" >
                    <f:param name="invoiceId" value="#{createInvoiceAddGrantBackingBean.invoice.id}" />
                </h:link>
            </div>
        </ui:fragment>

        <!-- Insert beneficiary's identification number -->
        <ui:fragment rendered="#{flow.showPersonalNumberInput and (invoice.calculateDifferenceExcludingVatAsKrona().unscaledValue() ne 0)}">
            <div class="grant-section">
                <div class="field-row">
                    <div class="field-element inline">
                        <h:outputLabel for="personalNumber" value="Personnummer:" />
                        <h:inputText id="personalNumber" styleClass="js-input-mask js-input-mask-personnumber"
                                     value="#{createInvoiceAddGrantBackingBean.number}"
                                     pt:placeholder="Skriv in personnummer..." pt:autofocus="true"
                                     pt:data-triggeronenter="#{createInvoiceAddGrantBackingBean.portletNamespace}:addGrantForm:personalNumberSubmit"
                        />
                    </div>
                </div>
                <div class="button-row">
                    <h:commandLink id="personalNumberSubmit" styleClass="link-btn primary" value="Fortsätt">
                        <f:ajax execute=":addGrantForm" listener="#{createInvoiceAddGrantBackingBean.personalNumberListener}"
                                render=":addGrantForm:grantAddPanel :addGrantForm:grantHistory" onevent="function eventHandler(data) {ajaxComplete(data)}" />
                    </h:commandLink>

                    <h:link styleClass="link-btn" value="Avbryt och gå till översikt" outcome="view_invoice" >
                        <f:param name="invoiceId" value="#{createInvoiceAddGrantBackingBean.invoice.id}" />
                    </h:link>

                </div>
            </div>
        </ui:fragment>
        <ui:fragment rendered="#{flow.showPersonalNumberOutput}">
            <div class="grant-section">

                <div class="grant-section-output">
                    <div class="person-info-row">
                        <div class="person-info-item personnumber">
                            <h:outputText value="#{grant.beneficiary.identification}" />
                        </div>
                        <div class="person-info-item">
                            <h:outputText value="#{grant.beneficiary.firstName} #{grant.beneficiary.lastName}" />
                        </div>
                    </div>

                    <h:commandLink styleClass="grant-section-back" immediate="true">
                        <f:ajax execute=":addGrantForm" listener="#{createInvoiceAddGrantBackingBean.stepBackListener}"
                                render=":addGrantForm:grantAddPanel :addGrantForm:grantHistory" onevent="function eventHandler(data) {ajaxComplete(data)}">
                        </f:ajax>
                        <f:param name="showSection" value="ENTER_PERSONAL_NUMBER" />
                        <span class="hide-accessible">Tillbaka</span>
                    </h:commandLink>

                </div>

            </div>
        </ui:fragment>

        <!-- Input delivery date -->
        <ui:fragment rendered="#{flow.showDeliveryDateInput}">
            <div class="grant-section">

                <div class="field-row">
                    <div class="field-element inline">
                        <h:outputLabel for="deliveryDate" value="Kvitteringsdatum:" />
                        <h:inputText id="deliveryDate" styleClass="js-input-mask js-input-mask-date"
                                     value="#{createInvoiceAddGrantBackingBean.deliveryDate}"
                                     pt:placeholder="ÅÅÅÅ-MM-DD" pt:autofocus="true"
                                     pt:data-triggeronenter="#{createInvoiceAddGrantBackingBean.portletNamespace}:addGrantForm:deliveryDateSubmit"
                        />
                    </div>
                </div>
            </div>
            <div class="button-row">
                <h:commandLink id="deliveryDateSubmit" styleClass="link-btn primary" value="Fortsätt">
                    <f:ajax execute=":addGrantForm" listener="#{createInvoiceAddGrantBackingBean.deliveryDateListener}"
                            render=":addGrantForm:grantAddPanel :addGrantForm:grantHistory" onevent="function eventHandler(data) {ajaxComplete(data)}" />
                </h:commandLink>
                <h:link styleClass="link-btn" value="Avbryt och gå till översikt" outcome="view_invoice" >
                    <f:param name="invoiceId" value="#{createInvoiceAddGrantBackingBean.invoice.id}" />
                </h:link>
            </div>
        </ui:fragment>
        <ui:fragment rendered="${flow.showDeliveryDateOutput}">
            <div class="grant-section">
                <div class="grant-section-output">
                    <span class="grant-section-label">
                        Kvitteringsdatum:
                    </span>
                    <span class="grant-section-data">
                        <h:outputText value="#{grant.deliveryDate}">
                            <f:convertDateTime type="date" pattern="yyyy-MM-dd" />
                        </h:outputText>
                    </span>

                    <h:commandLink styleClass="grant-section-back" immediate="true">
                        <f:ajax execute=":addGrantForm" listener="#{createInvoiceAddGrantBackingBean.stepBackListener}"
                                render=":addGrantForm:grantAddPanel :addGrantForm:grantHistory" onevent="function eventHandler(data) {ajaxComplete(data)}">
                        </f:ajax>
                        <f:param name="showSection" value="ENTER_DELIVERY_DATE" />
                        <span class="hide-accessible">Tillbaka</span>
                    </h:commandLink>
                </div>
            </div>
        </ui:fragment>

        <!-- Choose the grant type -->
        <ui:fragment rendered="#{flow.showGrantTypeInput}">
            <div class="grant-section">
                <div class="field-row">
                    <div class="field-element inline">
                        <h:outputLabel for="grantType" value="Bidragstyp:" />
                        <h:selectOneMenu id="grantType" value="#{createInvoiceAddGrantBackingBean.grantType}"
                                         pt:autofocus="true">
                            <f:selectItems value="#{createInvoiceAddGrantBackingBean.grantTypes}" />
                        </h:selectOneMenu>
                    </div>
                </div>
                <div class="button-row">
                    <h:commandLink styleClass="link-btn primary" value="Fortsätt">
                        <f:ajax execute=":addGrantForm" listener="#{createInvoiceAddGrantBackingBean.grantTypeListener}"
                                render=":addGrantForm:grantAddPanel" onevent="function eventHandler(data) {ajaxComplete(data)}" />
                    </h:commandLink>
                    <h:link styleClass="link-btn" value="Avbryt och gå till översikt" outcome="view_invoice" >
                        <f:param name="invoiceId" value="#{createInvoiceAddGrantBackingBean.invoice.id}" />
                    </h:link>
                </div>
            </div>
        </ui:fragment>
        <ui:fragment rendered="#{flow.showGrantTypeOutput}">
            <div class="grant-section">
                <div class="grant-section-output">
                    <span class="grant-section-label">
                        Bidragstyp:
                    </span>
                    <span class="grant-section-data">
                        <h:outputText value="#{createInvoiceAddGrantBackingBean.grantTypeLabel}" />
                    </span>
                    <h:commandLink styleClass="grant-section-back" immediate="true">
                        <f:ajax execute=":addGrantForm" listener="#{createInvoiceAddGrantBackingBean.stepBackListener}"
                                render=":addGrantForm:grantAddPanel :addGrantForm:grantHistory" onevent="function eventHandler(data) {ajaxComplete(data)}">
                        </f:ajax>
                        <f:param name="showSection" value="SELECT_GRANT_TYPE" />
                        <span class="hide-accessible">Tillbaka</span>
                    </h:commandLink>
                </div>
            </div>
        </ui:fragment>

        <!-- Grant Type 0-15 or 0-19 -->
        <ui:fragment rendered="#{flow.showGrantTypeAgeSection and flow.showPrescriptionDateInput}">
            <div class="grant-section">
                <div class="field-row">
                    <div class="field-element inline">
                        <h:outputLabel for="prescriptionDate" value="Receptdatum:" />
                        <h:inputText id="prescriptionDate" styleClass="js-input-mask js-input-mask-date"
                                     value="#{createInvoiceAddGrantBackingBean.prescriptionDate}"
                                     pt:placeholder="ÅÅÅÅ-MM-DD" pt:autofocus="true" />
                    </div>
                </div>
                <div class="button-row">
                    <h:commandLink styleClass="link-btn primary" value="Fortsätt">
                        <f:ajax execute=":addGrantForm" listener="#{createInvoiceAddGrantBackingBean.prescriptionDateListener}"
                                render=":addGrantForm:grantAddPanel" onevent="function eventHandler(data) {ajaxComplete(data)}" />
                    </h:commandLink>
                    <h:link styleClass="link-btn" value="Avbryt och gå till översikt" outcome="view_invoice" >
                        <f:param name="invoiceId" value="#{createInvoiceAddGrantBackingBean.invoice.id}" />
                    </h:link>
                </div>
            </div>
        </ui:fragment>

        <ui:fragment rendered="#{flow.showGrantTypeAgeSection and flow.showPrescriptionDateOutput}">
            <div class="grant-section">
                <div class="grant-section-output">
                    <span class="grant-section-label">
                        Receptdatum:
                    </span>
                    <span class="grant-section-data">
                        <h:outputText value="#{grant.beneficiary.prescription.date}">
                            <f:convertDateTime type="date" pattern="yyyy-MM-dd" />
                        </h:outputText>
                    </span>
                    <h:commandLink styleClass="grant-section-back" immediate="true">
                        <f:ajax execute=":addGrantForm" listener="#{createInvoiceAddGrantBackingBean.stepBackListener}"
                                render=":addGrantForm:grantAddPanel :addGrantForm:grantHistory" onevent="function eventHandler(data) {ajaxComplete(data)}">
                        </f:ajax>
                        <f:param name="showSection" value="ENTER_PRESCRIPTION_DATE" />
                        <span class="hide-accessible">Tillbaka</span>
                    </h:commandLink>
                </div>
            </div>
        </ui:fragment>


        <!-- Grant type others -->
        <ui:fragment rendered="#{flow.showGrantTypeOtherSection and flow.showPrescriptionTypeInput}">


            <div class="grant-section">
                <div class="field-row">

                    <div class="prescription-section">
                        <div class="prescription-section-main">
                            <div class="field-element field-element-toggle">
                                <h:selectBooleanCheckbox id="afaki" value="#{otherVO.aphakia}">
                                    <f:ajax execute=":addGrantForm"
                                            listener="#{createInvoiceAddGrantBackingBean.changePrescriptionTypeListener}"
                                            render=":addGrantForm:grantAddPanel"
                                            onevent="function eventHandler(data) {ajaxComplete(data)}" />
                                </h:selectBooleanCheckbox>
                                <h:outputLabel for="afaki" value="Afaki:" />
                            </div>
                        </div>
                        <div class="prescription-section-fields">
                            <ui:fragment rendered="#{otherVO.aphakia}">
                                <div class="prescription-section-fieldset">
                                    <div class="prescription-section-field">
                                        <h:selectBooleanCheckbox id="afakiEyeSightBilateral" value="#{otherVO.aphakiaBilateral}" />
                                        <h:outputLabel for="afakiEyeSightBilateral" value="Bilat." />
                                    </div>
                                    <div class="prescription-section-field">
                                        <h:selectBooleanCheckbox id="afakiEyeSightRight" value="#{otherVO.aphakiaRight}" />
                                        <h:outputLabel for="afakiEyeSightRight" value="Hö" />
                                    </div>
                                    <div class="prescription-section-field">
                                        <h:selectBooleanCheckbox id="afakiEyeSightLeft" value="#{otherVO.aphakiaLeft}" />
                                        <h:outputLabel for="afakiEyeSightLeft" value="Vä" />
                                    </div>
                                </div>
                            </ui:fragment>
                        </div>
                    </div>

                    <div class="prescription-section">
                        <div class="prescription-section-main">
                            <div class="field-element field-element-toggle">
                                <h:selectBooleanCheckbox id="keratokonus" value="#{otherVO.keratoconus}" pt:autofocus="true">
                                <f:ajax execute=":addGrantForm"
                                        listener="#{createInvoiceAddGrantBackingBean.changePrescriptionTypeListener}"
                                        render=":addGrantForm:grantAddPanel"
                                        onevent="function eventHandler(data) {ajaxComplete(data)}" />
                                </h:selectBooleanCheckbox>
                                <h:outputLabel for="keratokonus" value="Keratokonus:" />
                            </div>
                        </div>
                        <div class="prescription-section-fields">
                            <ui:fragment rendered="#{otherVO.keratoconus}">

                                <div class="prescription-section-fieldset">
                                    <div class="prescription-section-field">
                                        <h:selectBooleanCheckbox id="keratokonusEyeSightBilateral" value="#{otherVO.keratoconusBilateral}" />
                                        <h:outputLabel for="keratokonusEyeSightBilateral" value="Bilat." />
                                    </div>
                                    <div class="prescription-section-field">
                                        <h:selectBooleanCheckbox id="keratokonusEyeSightRight" value="#{otherVO.keratoconusRight}" />
                                        <h:outputLabel for="keratokonusEyeSightRight" value="Hö" />
                                    </div>
                                    <div class="prescription-section-field">
                                        <h:selectBooleanCheckbox id="keratokonusEyeSightLeft" value="#{otherVO.keratoconusLeft}" />
                                        <h:outputLabel for="keratokonusEyeSightLeft" value="Vä" />
                                    </div>
                                </div>


                                <div class="prescription-section-fieldset">
                                    <div class="prescription-section-field">
                                        <h:outputLabel for="keratokonusVisualAcuityRight" value="Hö" />
                                        <h:inputText id="keratokonusVisualAcuityRight"
                                                     value="#{otherVO.keratoconusRightAdjustment}"
                                                     pt:placeholder="" styleClass="input-very-short" />
                                    </div>

                                    <div class="prescription-section-field">
                                        <h:outputLabel for="keratokonusVisualAcuityLeft" value="Vä" />
                                        <h:inputText id="keratokonusVisualAcuityLeft"
                                                     value="#{otherVO.keratoconusLeftAdjustment}"
                                                     pt:placeholder="" styleClass="input-very-short"  />
                                    </div>

                                    <div class="prescription-section-field">
                                        <span>
                                            Med glaskorr.
                                        </span>
                                    </div>

                                </div>


                                <div class="prescription-section-fieldset">
                                    <div class="prescription-section-field">
                                        <h:selectBooleanCheckbox id="keratokonusNoGlasses" value="#{otherVO.keratoconusNoGlass}" />
                                        <h:outputLabel for="keratokonusNoGlasses" value="Ej glas" />
                                    </div>
                                </div>

                            </ui:fragment>
                        </div>
                    </div>

                    <div class="prescription-section">
                        <div class="prescription-section-main">
                            <div class="field-element field-element-toggle">
                                <h:selectBooleanCheckbox id="special" value="#{otherVO.special}">
                                    <f:ajax execute=":addGrantForm"
                                            listener="#{createInvoiceAddGrantBackingBean.changePrescriptionTypeListener}"
                                            render=":addGrantForm:grantAddPanel"
                                            onevent="function eventHandler(data) {ajaxComplete(data)}" />
                                </h:selectBooleanCheckbox>
                                <h:outputLabel for="special" value="Spec / synsvag:" />
                            </div>
                        </div>
                        <div class="prescription-section-fields">
                            <ui:fragment rendered="#{otherVO.special}">
                                <div>
                                    <div class="prescription-section-fieldset">
                                        <div class="prescription-section-field">
                                            <h:selectBooleanCheckbox id="specialWeakEyeSight" value="#{otherVO.specialWeakSight}" />
                                            <h:outputLabel for="specialWeakEyeSight" value="Synsvag" />
                                        </div>

                                        <div class="prescription-section-field">
                                            <h:selectBooleanCheckbox id="specialEyeSightBilateral" value="#{otherVO.specialBilateral}" />
                                            <h:outputLabel for="specialEyeSightBilateral" value="Bilat." />
                                        </div>
                                        <div class="prescription-section-field">
                                            <h:selectBooleanCheckbox id="specialEyeSightRight" value="#{otherVO.specialRight}" />
                                            <h:outputLabel for="specialEyeSightRight" value="Hö" />
                                        </div>
                                        <div class="prescription-section-field">
                                            <h:selectBooleanCheckbox id="specialEyeSightLeft" value="#{otherVO.specialLeft}" />
                                            <h:outputLabel for="specialEyeSightLeft" value="Vä" />
                                        </div>
                                    </div>
                                </div>
                            </ui:fragment>
                        </div>
                    </div>

                </div>
                <div class="button-row">
                    <h:commandLink styleClass="link-btn primary" value="Fortsätt">
                        <f:ajax execute=":addGrantForm" listener="#{createInvoiceAddGrantBackingBean.otherPrescriptionTypeListener}"
                                render=":addGrantForm:grantAddPanel" onevent="function eventHandler(data) {ajaxComplete(data)}" />
                    </h:commandLink>
                    <h:link styleClass="link-btn" value="Avbryt och gå till översikt" outcome="view_invoice" >
                        <f:param name="invoiceId" value="#{createInvoiceAddGrantBackingBean.invoice.id}" />
                    </h:link>
                </div>
            </div>

        </ui:fragment>

        <ui:fragment rendered="#{flow.showGrantTypeOtherSection and flow.showPrescriptionTypeOutput}">
            <div class="grant-section">
                <div class="grant-section-output">
                    You inserted some values!

                    <h:commandLink styleClass="grant-section-back" immediate="true">
                        <f:ajax execute=":addGrantForm" listener="#{createInvoiceAddGrantBackingBean.stepBackListener}"
                                render=":addGrantForm:grantAddPanel :addGrantForm:grantHistory" onevent="function eventHandler(data) {ajaxComplete(data)}">
                        </f:ajax>
                        <f:param name="showSection" value="ENTER_GRANT_STATE_OTHER_TYPE" />
                        <span class="hide-accessible">Tillbaka</span>
                    </h:commandLink>
                </div>
            </div>
        </ui:fragment>

        <ui:fragment rendered="#{flow.showGrantTypeOtherSection and flow.showPrescriptionDateInput}">

            <div class="grant-section">
                <div class="field-row field-row-3">
                    <div class="field-element inline">
                        <h:outputLabel for="prescriber" value="Ordinatör:" />
                        <h:inputText id="prescriber" styleClass=""
                                     value="#{createInvoiceAddGrantBackingBean.prescriber}"
                                     pt:placeholder="Skriv in ordindatör..." pt:autofocus="true" />
                    </div>
                    <div class="field-element inline">
                        <h:outputLabel for="prescriptionDate2" value="Receptdatum:" />
                        <h:inputText id="prescriptionDate2" styleClass="js-input-mask js-input-mask-date"
                                     value="#{createInvoiceAddGrantBackingBean.prescriptionDate}"
                                     pt:placeholder="ÅÅÅÅ-MM-DD" />
                    </div>
                    <div class="field-element inline">
                        <h:outputLabel for="prescriptionNote" value="Anteckningar:" />
                        <h:inputTextarea id="prescriptionNote" value="#{createInvoiceAddGrantBackingBean.prescriptionComment}"  />
                    </div>

                </div>
                <div class="button-row">
                    <h:commandLink styleClass="link-btn primary" value="Fortsätt">
                        <f:ajax execute=":addGrantForm" listener="#{createInvoiceAddGrantBackingBean.otherPrescriptionDateListener}"
                                render=":addGrantForm:grantAddPanel" onevent="function eventHandler(data) {ajaxComplete(data)}" />
                    </h:commandLink>
                    <h:link styleClass="link-btn" value="Avbryt och gå till översikt" outcome="view_invoice" >
                        <f:param name="invoiceId" value="#{createInvoiceAddGrantBackingBean.invoice.id}" />
                    </h:link>
                </div>
            </div>

        </ui:fragment>

        <ui:fragment rendered="#{flow.showGrantTypeOtherSection and flow.showPrescriptionDateOutput}">
            <div class="grant-section">
                <div class="grant-section-output">
                    More values where inserted

                    <h:commandLink styleClass="grant-section-back" immediate="true">
                        <f:ajax execute=":addGrantForm" listener="#{createInvoiceAddGrantBackingBean.stepBackListener}"
                                render=":addGrantForm:grantAddPanel :addGrantForm:grantHistory" onevent="function eventHandler(data) {ajaxComplete(data)}">
                        </f:ajax>
                        <f:param name="showSection" value="ENTER_GRANT_STATE_OTHER_DATE" />
                        <span class="hide-accessible">Tillbaka</span>
                    </h:commandLink>
                </div>
            </div>
        </ui:fragment>

        <!-- Input amount -->
        <ui:fragment rendered="#{flow.showAmountInput}">
            <div class="grant-section">
                <div class="field-row">
                    <div class="field-element inline">
                        <h:outputLabel for="amountWithVat" value="Summa:" />
                        <h:inputText id="amountWithVat" styleClass=""
                                     value="#{createInvoiceAddGrantBackingBean.amountWithVat}"
                                     pt:placeholder="Skriv in bidragssumma..." pt:autofocus="true"
                                     onfocus="this.select"

                        />
                    </div>
                </div>
                <div class="button-row">

                    <h:commandLink styleClass="link-btn primary" value="Spara och registrera nytt"
                                   action="#{createInvoiceAddGrantBackingBean.doSaveGrantAndAddNew}" />

                    <h:commandLink styleClass="link-btn" value="Spara och gå till översikt"
                                   action="#{createInvoiceAddGrantBackingBean.saveGrant}" />
                </div>
            </div>
        </ui:fragment>

    </h:body>
</f:view>